<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bio-Roll: Empire & Particle Update</title>
    <style>
        :root { 
            --common: #95a5a6; --uncommon: #2ecc71; --rare: #3498db; 
            --legendary: #f1c40f; --mythic: #9b59b6; --god: #ff3e3e; 
            --shiny: #ff69b4; --doge: #ffcc00; --panel: rgba(12, 12, 12, 0.98);
        }
        
        body { background: #000; color: #fff; font-family: 'Inter', sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        #flash { position: fixed; inset: 0; background: #fff; opacity: 0; pointer-events: none; z-index: 2000; transition: opacity 0.1s; }

        /* Particle Canvas */
        #particle-canvas { position: absolute; inset: 0; pointer-events: none; z-index: 1; }

        /* Layout */
        .sidebar { width: 300px; background: var(--panel); border-right: 1px solid #222; padding: 20px; display: flex; flex-direction: column; z-index: 10; overflow-y: auto; }
        .main-game { flex-grow: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; z-index: 5; }
        .shop-panel { width: 320px; background: var(--panel); border-left: 1px solid #222; padding: 20px; z-index: 10; overflow-y: auto; }

        /* Gallery */
        #gallery-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 1500;
            display: none; padding: 40px; overflow-y: auto; backdrop-filter: blur(15px);
        }
        .gallery-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(90px, 1fr)); gap: 12px; }
        .gallery-card { background: #111; border-radius: 12px; padding: 10px; text-align: center; border: 1px solid #222; }
        .locked { opacity: 0.1; filter: grayscale(1); }

        /* Central Display */
        #display-stage { position: relative; width: 350px; height: 350px; display: flex; align-items: center; justify-content: center; }
        .skin-layer { position: absolute; font-size: 10rem; z-index: 5; transition: 0.2s; }
        .aura-layer { position: absolute; font-size: 15rem; opacity: 0.2; filter: blur(45px); animation: pulse 3s infinite alternate; }
        @keyframes pulse { from { transform: scale(0.85); } to { transform: scale(1.1); } }

        /* UI */
        .stat-card { background: rgba(255,255,255,0.03); border: 1px solid #333; border-radius: 12px; padding: 12px; margin-bottom: 10px; }
        .btn { width: 100%; padding: 15px; border: none; border-radius: 10px; cursor: pointer; font-weight: 800; transition: 0.2s; }
        .shop-btn { background: #27ae60; color: #fff; margin-top: 5px; font-size: 0.75rem; }
        .shop-btn:disabled { background: #333; opacity: 0.4; }
        .tag { font-size: 0.65rem; letter-spacing: 3px; font-weight: bold; color: #555; margin-bottom: 10px; display: block; }
    </style>
</head>
<body>

<div id="flash"></div>
<canvas id="particle-canvas"></canvas>

<div id="gallery-overlay">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        <h1 style="color:var(--rare)">BIOME ARCHIVE</h1>
        <button class="btn" style="width:100px; background:#e74c3c; color:#fff" onclick="toggleGallery()">CLOSE</button>
    </div>
    <div id="gallery-content" class="gallery-grid"></div>
</div>

<div class="sidebar">
    <span class="tag">BIOMETRICS</span>
    <div class="stat-card">
        <small style="color:#666">TOTAL SAMPLES</small><br>
        <b id="total-rolls" style="font-size:1.4rem">0</b>
    </div>
    <div class="stat-card">
        <small style="color:#666">LUCK LEVEL</small><br>
        <b id="luck-level" style="color:var(--uncommon)">1.0x</b>
    </div>
    
    <span class="tag" style="margin-top:15px;">COLLECTION</span>
    <div id="inv-display" style="font-size: 0.8rem;"></div>
    
    <button class="btn" style="background:#222; color:#fff; margin-top:auto;" onclick="toggleGallery()">ğŸ“– OPEN ARCHIVE</button>
</div>

<div class="main-game">
    <div id="display-stage">
        <div id="aura-layer" class="aura-layer"></div>
        <div id="skin-layer" class="skin-layer">ğŸ¥š</div>
    </div>
    <div id="rarity-tag" class="tag" style="color:#fff; opacity:0.6;">READY FOR SCAN</div>
    <div id="animal-name" style="font-size: 2.8rem; font-weight: 900; margin: 10px 0; text-align:center;">BIO-ROLLER</div>
    
    <div style="width: 320px;">
        <button class="btn" style="background:#fff; color:#000; font-size:1.3rem" onclick="roll()">ROLL SEQUENCE</button>
        <div style="display:flex; justify-content:center; gap:20px; margin-top:10px;">
            <label style="font-size: 0.7rem; color: #444; cursor:pointer;"><input type="checkbox" id="turbo"> TURBO</label>
        </div>
    </div>
</div>

<div class="shop-panel">
    <span class="tag">EMPIRE SHOP</span>
    <div class="stat-card">
        <b style="color:var(--god)">âš¡ Auto-Splicer</b>
        <p style="font-size:0.6rem; color:#888;">Automate 1 roll every 2 seconds.</p>
        <button class="btn shop-btn" onclick="buy('auto')" id="auto-btn">Cost: 1 Mythic</button>
    </div>
    <div class="stat-card">
        <b style="color:var(--legendary)">ğŸŒ€ Mega Roll (x100)</b>
        <p style="font-size:0.6rem; color:#888;">One huge burst of 100 animals.</p>
        <button class="btn shop-btn" onclick="bulkRoll(100)" id="mega-btn">Cost: 5 Legendary</button>
    </div>
    <div class="stat-card">
        <b style="color:var(--rare)">ğŸ› ï¸ Forge Legendary</b>
        <p style="font-size:0.6rem; color:#888;">Convert 50 Rares into 1 Legendary.</p>
        <button class="btn shop-btn" onclick="craft('Legendary')" id="forge-btn">Cost: 50 Rare</button>
    </div>
    <div class="stat-card">
        <b style="color:var(--uncommon)">ğŸ€ Luck Serum II</b>
        <p style="font-size:0.6rem; color:#888;">Permanent +2.0 Luck boost.</p>
        <button class="btn shop-btn" onclick="buy('luck')" id="luck-btn">Cost: 200 Uncommon</button>
    </div>
</div>

<script>
    const db = {
        Common: [
            {id:"c1", n:"Cat", e:"ğŸˆ", a:"ğŸ¾"}, {id:"c2", n:"Rat", e:"ğŸ€", a:"ğŸ§€"}, 
            {id:"c3", n:"Ant", e:"ğŸœ", a:"ğŸ‚"}, {id:"c4", n:"Snail", e:"ğŸŒ", a:"ğŸŒ±"},
            {id:"c5", n:"Crab", e:"ğŸ¦€", a:"ğŸ–ï¸"}, {id:"c6", n:"Bat", e:"ğŸ¦‡", a:"ğŸŒ‘"}
        ],
        Uncommon: [
            {id:"u1", n:"Fox", e:"ğŸ¦Š", a:"âœ¨"}, {id:"u2", n:"Deer", e:"ğŸ¦Œ", a:"ğŸŒ²"},
            {id:"u3", n:"Owl", e:"ğŸ¦‰", a:"ğŸŒ™"}, {id:"u4", n:"Sloth", e:"ğŸ¦¥", a:"ğŸƒ"},
            {id:"u5", n:"Koala", e:"ğŸ¨", a:"ğŸ¨"}
        ],
        Rare: [
            {id:"r1", n:"DOGE", e:"ğŸ•", a:"ğŸ¦´"}, {id:"r2", n:"Shark", e:"ğŸ¦ˆ", a:"ğŸŒŠ"},
            {id:"r3", n:"Rex", e:"ğŸ¦–", a:"ğŸŒ‹"}, {id:"r4", n:"Lion", e:"ğŸ¦", a:"ğŸŒ…"},
            {id:"r5", n:"Mammoth", e:"ğŸ¦£", a:"â„ï¸"}
        ],
        Legendary: [
            {id:"l1", n:"Phoenix", e:"ğŸ¦â€ğŸ”¥", a:"ğŸ”¥"}, {id:"l2", n:"Dragon", e:"ğŸ²", a:"âš¡"},
            {id:"
